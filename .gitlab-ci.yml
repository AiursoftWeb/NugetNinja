stages:
  - restore
  - build
  - analyze
  - test
  - publish
  - pack

before_script:
  - export DOTNET_CLI_TELEMETRY_OPTOUT=1

restore:
  stage: restore
  script:
    - dotnet restore --configfile nuget.config

build:
  stage: build
  script:
    - dotnet build --configuration Release --no-self-contained

analyze:
  stage: analyze
  script:
    - dotnet tool install JetBrains.ReSharper.GlobalTools --global
    - jb inspectcode /path/to/your/solution.sln -o analyze_output.xml
  artifacts:
    paths:
      - analyze_output.xml
  tags:
    - analyzer

test:
  stage: test
  script:
    - dotnet test --collect "Code coverage"

publish:
  stage: publish
  script:
    - dotnet publish --configuration Release --output --runtime linux-x64 --no-self-contained --projects '**/*.csproj'

pack:
  stage: pack
  script:
    - dotnet pack --configuration Release --project src/NugetNinja/NugetNinja.csproj
